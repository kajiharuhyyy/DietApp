<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
  <meta charset="UTF-8">
  <title th:text="${pageTitle}">食事入力</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    .wrap{max-width:920px;margin:24px auto;padding:0 12px}
    .row{display:flex;align-items:center;gap:12px;margin:6px 0}
    .bar{flex:1;height:10px;background:#eee;border-radius:4px;overflow:hidden}
    .bar>div{height:100%}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{border-bottom:1px solid #ddd;padding:8px}
    .right{text-align:right}
    .muted{color:#666}
    .msg{color:#0a7}
    .btn-danger{background:#c33;color:#fff;border:none;padding:4px 10px;border-radius:4px;cursor:pointer}
    .btn{padding:6px 12px;border-radius:4px;border:1px solid #ccc;background:#fafafa;cursor:pointer}
  </style>
</head>
<body>
<div class="wrap">

  <h2 th:text="${pageTitle}">食事入力</h2>

  <!-- フラッシュメッセージ -->
  <p class="msg" th:if="${msg != null}" th:text="${msg}"></p>

  <!-- 追加フォーム -->
    <form th:action="@{/diet/meal}" method="post" th:object="${mealForm}">
    <label>食品</label>
    <select th:field="*{foodId}">
        <option th:each="f : ${foods}" th:value="${f.id}" th:text="${f.name}"></option>
    </select>

    <label>量(g)</label>
    <input type="number" th:field="*{grams}" min="1" step="1"/>

    <button type="submit">追加</button>
    </form>

<!-- 削除ボタン（行ごと） -->
    <form th:action="@{'/diet/meal/' + ${m.id} + '/delete'}" method="post">
    <button type="submit" class="danger">削除</button>
    </form>


  <!-- 今日の目標と進捗 -->
  <section th:if="${target != null}">
    <h3 style="margin-top:24px;">今日の食事</h3>
  <table>
    <thead>
      <tr>
        <th>食品</th>
        <th class="right">量(g)</th>
        <th class="right">kcal</th>
        <th class="right">P(g)</th>
        <th class="right">F(g)</th>
        <th class="right">C(g)</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="m : ${meals}">
        <td th:text="${m.foodName}">ごはん</td>
        <td class="right" th:text="${m.grams}">100</td>
        <td class="right" th:text="${m.energyKcal}">168</td>
        <td class="right" th:text="${m.proteinG}">3.0</td>
        <td class="right" th:text="${m.fatG}">0.3</td>
        <td class="right" th:text="${m.carbG}">37</td>
        <td class="right">
      </tr>
      <tr th:if="${#lists.isEmpty(meals)}">
        <td colspan="7" class="muted">まだ登録がありません。</td>
      </tr>
    </tbody>
  </table>

    <h3 style="margin-top:16px;">今日の進捗</h3>
  <!-- 食事一覧 -->
    <div class="row">
      <div class="muted">エネルギー</div>
      <div class="bar">
        <div th:style="|width:${(target.energyKcal != null and target.energyKcal > 0) ? (totals.energyKcal * 100 / target.energyKcal) : 0}%|"></div>
      </div>
      <div class="muted">
        <span th:text="${totals.energyKcal}">0</span> /
        <span th:text="${target.energyKcal}">1800</span> kcal
      </div>
    </div>

    <div class="row">
      <div class="muted">たんぱく質</div>
      <div class="bar">
        <div th:style="|width:${(target.proteinG != null and target.proteinG > 0) ? (totals.proteinG * 100 / target.proteinG) : 0}%|"></div>
      </div>
      <div class="muted">
        <span th:text="${totals.proteinG}">0</span> /
        <span th:text="${target.proteinG}">60</span> g
      </div>
    </div>

    <div class="row">
      <div class="muted">炭水化物</div>
      <div class="bar">
        <div th:style="|width:${(target.carbG != null and target.carbG > 0) ? (totals.carbG * 100 / target.carbG) : 0}%|"></div>
      </div>
      <div class="muted">
        <span th:text="${totals.carbG}">0</span> /
        <span th:text="${target.carbG}">260</span> g
      </div>
    </div>

    <div class="row">
      <div class="muted">脂質</div>
      <div class="bar">
        <div th:style="|width:${(target.fatG != null and target.fatG > 0) ? (totals.fatG * 100 / target.fatG) : 0}%|"></div>
      </div>
      <div class="muted">
        <span th:text="${totals.fatG}">0</span> /
        <span th:text="${target.fatG}">50</span> g
      </div>
    </div>
  </section>


  

  <p style="margin-top:16px;"><a th:href="@{/diet/select}">← モード選択に戻る</a></p>
</div>
</body>
</html>
